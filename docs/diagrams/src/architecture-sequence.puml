@startuml Sequence Diagram
!theme plain

title Uber Application Sequence Diagram - Ride Booking Process

actor Customer
participant "Mobile App" as mobile_app
participant "API Gateway" as api_gateway
participant "User Service" as user_service
participant "Driver Service" as driver_service
participant "Payment Service" as payment_service
participant "Notification Service" as notification_service
database "Database" as database
participant "Cache" as cache
participant "Message Queue" as message_queue
participant "External Payment Gateway" as external_payment_gateway

== Customer Authentication ==
Customer -> mobile_app: Login Request
mobile_app -> api_gateway: Forward Login Request
api_gateway -> user_service: Authenticate User
user_service -> database: Validate Credentials
database -> user_service: Return User Data
user_service -> cache: Store Session
user_service -> api_gateway: Authentication Response
api_gateway -> mobile_app: Login Success/Failure
mobile_app -> Customer: Display Result

== Find Nearby Drivers ==
Customer -> mobile_app: Request Ride
mobile_app -> api_gateway: Get Available Drivers
api_gateway -> driver_service: Find Nearby Drivers
driver_service -> database: Query Driver Locations
database -> driver_service: Return Driver List
driver_service -> api_gateway: Available Drivers
api_gateway -> mobile_app: Driver Options
mobile_app -> Customer: Display Driver Options

== Book Ride ==
Customer -> mobile_app: Select Driver & Confirm Ride
mobile_app -> api_gateway: Create Ride Request
api_gateway -> user_service: Validate User
user_service -> cache: Check User Status
user_service -> api_gateway: Validation Result
api_gateway -> driver_service: Assign Ride to Driver
driver_service -> database: Update Ride Status
database -> driver_service: Confirmation
driver_service -> message_queue: Publish Ride Assignment
message_queue -> notification_service: Process Notification
notification_service -> mobile_app: Send Driver Assignment
notification_service -> "Driver App": Notify Driver Assignment
driver_service -> api_gateway: Ride Created Response
api_gateway -> mobile_app: Ride Confirmed
mobile_app -> Customer: Show Ride Status

== Process Payment ==
Customer -> mobile_app: Confirm Ride Completion
mobile_app -> api_gateway: Complete Ride Request
api_gateway -> payment_service: Process Payment
payment_service -> database: Retrieve Payment Info
database -> payment_service: Payment Details
payment_service -> external_payment_gateway: Charge Customer
external_payment_gateway -> payment_service: Payment Confirmation
payment_service -> database: Update Transaction
database -> payment_service: Transaction Saved
payment_service -> message_queue: Publish Payment Event
message_queue -> notification_service: Send Receipt
notification_service -> mobile_app: Send Receipt to Customer
notification_service -> "Driver App": Send Payment to Driver
payment_service -> api_gateway: Payment Success
api_gateway -> mobile_app: Payment Confirmed
mobile_app -> Customer: Show Receipt

@enduml
